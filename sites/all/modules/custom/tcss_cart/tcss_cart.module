<?php

/**
  * Implments hook_theme
  */
function tcss_cart_theme() {
 return array(
    'abc_thumb_upload' => array(
        'render element' => 'element',
));
}

function tcss_cart_form_alter(&$form, &$form_state, $form_id) {
dpm($form);
  switch ($form_id) {
    case 'uc_cart_view_form':

      break;

    default:
      # code...
      break;
  }
  if ($form_id == 'offers_node_form') {
       $offer_type = arg(3);
    $price = arg(4);
    if ($offer_type == 'starterpack' || $offer_type == 'buisnesspack') {
      $images_field = 2;
    }

    if (isset($_SESSION['image_field'])) {
      $images_field = $_SESSION['image_field'];
    }
    else {
      $_SESSION['image_field'] = $images_field;
    }
    for ($i=0; $i < $images_field; $i++) {
      $form['field_offers_image_' . $i] = array(
      '#title' => t('Upload image'),
      '#type' => 'managed_file',
      '#description' => t('The uploaded image will be displayed on this page using the image style choosen below.'),
      '#upload_location' => 'public://',
      '#theme' => 'abc_thumb_upload',
      '#default_value' => $form['field_offers_image']['und'][0]['#default_value']['fid'],
      );
     }
    $form['images_field'] = array('#type' => 'hidden', '#value' => $images_field);
    $form['field_offers_price']['und'][0]['value']['#value'] = $price;
    $form['field_offers_price']['#disabled'] = TRUE;
    $form['field_offers_image']['#access'] = FALSE;
    array_unshift($form['actions']['submit']['#submit'], 'offers_image_submit');
    }
}

function offers_image_submit($form, &$form_state) {
  unset($_SESSION['image_field']);
  $images_field = $form_state['values']['images_field'];
   for ($i=0; $i < $images_field; $i++) {
      $form_state['values']['field_offers_image']['und'][$i]['fid'] = $form_state['values']['field_offers_image_' . $i];
     }
}

function theme_abc_thumb_upload($variables) {

    $element = $variables['element'];

    if (isset($element['#file']->uri)) {
        $output = '<div id="edit-logo-ajax-wrapper"><div class="form-item form-type-managed-file form-item-logo"><span class="file">';
        $output .= '<img height="50px" src="' . file_create_url($element['#file']->uri) . '" />';
        $output .= '</span><input type="submit" id="edit-' . $element['#name'] . '-remove-button" name="' . $element['#name'] . '_remove_button" value="Remove" class="form-submit ajax-processed">';
        $output .= '<input type="hidden" name="' . $element['#name'] . '[fid]" value="' . $element['#file']->fid . '">';

        return $output;
    }
}


function tcss_cart_uc_add_to_cart_data($form_values) {
  dpm($form_values);
}

function tcss_cart_uc_product_alter(&$node){
  $node->default_qty = 100;
}
